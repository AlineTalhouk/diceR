<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Consensus clustering — consensus_cluster • diceR</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Consensus clustering — consensus_cluster"><meta name="description" content="Runs consensus clustering across subsamples of the data, clustering
algorithms, and cluster sizes."><meta property="og:description" content="Runs consensus clustering across subsamples of the data, clustering
algorithms, and cluster sizes."><meta property="og:image" content="https://alinetalhouk.github.io/diceR/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">diceR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/AlineTalhouk/diceR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Consensus clustering</h1>
      <small class="dont-index">Source: <a href="https://github.com/AlineTalhouk/diceR/blob/HEAD/R/consensus_cluster.R" class="external-link"><code>R/consensus_cluster.R</code></a></small>
      <div class="d-none name"><code>consensus_cluster.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Runs consensus clustering across subsamples of the data, clustering
algorithms, and cluster sizes.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">consensus_cluster</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  nk <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>  p.item <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  reps <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  algorithms <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nmf.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"brunet"</span>, <span class="st">"lee"</span><span class="op">)</span>,</span>
<span>  hc.method <span class="op">=</span> <span class="st">"average"</span>,</span>
<span>  xdim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ydim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rlen <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>  minPts <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  distance <span class="op">=</span> <span class="st">"euclidean"</span>,</span>
<span>  abs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  prep.data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"full"</span>, <span class="st">"sampled"</span><span class="op">)</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"conventional"</span>, <span class="st">"robust"</span>, <span class="st">"tsne"</span><span class="op">)</span>,</span>
<span>  min.var <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed.nmf <span class="op">=</span> <span class="fl">123456</span>,</span>
<span>  seed.data <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  file.name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  time.saved <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>data matrix with rows as samples and columns as variables</p></dd>


<dt id="arg-nk">nk<a class="anchor" aria-label="anchor" href="#arg-nk"></a></dt>
<dd><p>number of clusters (k) requested; can specify a single integer or a
range of integers to compute multiple k</p></dd>


<dt id="arg-p-item">p.item<a class="anchor" aria-label="anchor" href="#arg-p-item"></a></dt>
<dd><p>proportion of items to be used in subsampling within an
algorithm</p></dd>


<dt id="arg-reps">reps<a class="anchor" aria-label="anchor" href="#arg-reps"></a></dt>
<dd><p>number of subsamples</p></dd>


<dt id="arg-algorithms">algorithms<a class="anchor" aria-label="anchor" href="#arg-algorithms"></a></dt>
<dd><p>vector of clustering algorithms for performing consensus
clustering. Must be any number of the following: "nmf", "hc", "diana",
"km", "pam", "ap", "sc", "gmm", "block", "som", "cmeans", "hdbscan". A
custom clustering algorithm can be used.</p></dd>


<dt id="arg-nmf-method">nmf.method<a class="anchor" aria-label="anchor" href="#arg-nmf-method"></a></dt>
<dd><p>specify NMF-based algorithms to run. By default the
"brunet" and "lee" algorithms are called. See <code><a href="https://rdrr.io/pkg/NMF/man/nmf.html" class="external-link">NMF::nmf()</a></code> for details.</p></dd>


<dt id="arg-hc-method">hc.method<a class="anchor" aria-label="anchor" href="#arg-hc-method"></a></dt>
<dd><p>agglomeration method for hierarchical clustering. The
the "average" method is used by default. See<code><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">stats::hclust()</a></code> for details.</p></dd>


<dt id="arg-xdim">xdim<a class="anchor" aria-label="anchor" href="#arg-xdim"></a></dt>
<dd><p>x dimension of the SOM grid</p></dd>


<dt id="arg-ydim">ydim<a class="anchor" aria-label="anchor" href="#arg-ydim"></a></dt>
<dd><p>y dimension of the SOM grid</p></dd>


<dt id="arg-rlen">rlen<a class="anchor" aria-label="anchor" href="#arg-rlen"></a></dt>
<dd><p>the number of times the complete data set will be presented to
the SOM network.</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>SOM learning rate, a vector of two numbers indicating the amount
of change. Default is to decline linearly from 0.05 to 0.01 over <code>rlen</code>
updates. Not used for the batch algorithm.</p></dd>


<dt id="arg-minpts">minPts<a class="anchor" aria-label="anchor" href="#arg-minpts"></a></dt>
<dd><p>minimum size of clusters for HDBSCAN. Default is 5.</p></dd>


<dt id="arg-distance">distance<a class="anchor" aria-label="anchor" href="#arg-distance"></a></dt>
<dd><p>a vector of distance functions. Defaults to "euclidean".
Other options are given in <code><a href="https://rdrr.io/r/stats/dist.html" class="external-link">stats::dist()</a></code>. A custom distance function can
be used.</p></dd>


<dt id="arg-abs">abs<a class="anchor" aria-label="anchor" href="#arg-abs"></a></dt>
<dd><p>only used for <code>distance = c("spearman", "pearson")</code>. If <code>TRUE</code>,
the absolute value is first applied to the distance before subtracting from
1, e.g., we use 1 - |SCD| instead of 1 - SCD for the spearman correlation
distance.</p></dd>


<dt id="arg-prep-data">prep.data<a class="anchor" aria-label="anchor" href="#arg-prep-data"></a></dt>
<dd><p>Prepare the data on the "full" dataset, the "sampled"
dataset, or "none" (default).</p></dd>


<dt id="arg-scale">scale<a class="anchor" aria-label="anchor" href="#arg-scale"></a></dt>
<dd><p>logical; should the data be centered and scaled?</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>if we use "conventional" measures (default), then the mean and
standard deviation are used for centering and scaling, respectively. If
"robust" measures are specified, the median and median absolute deviation
(MAD) are used. Alternatively, we can apply "tsne" for dimension reduction.</p></dd>


<dt id="arg-min-var">min.var<a class="anchor" aria-label="anchor" href="#arg-min-var"></a></dt>
<dd><p>minimum variability measure threshold used to filter the
feature space for only highly variable features. Only features with a
minimum variability measure across all samples greater than <code>min.var</code> will
be used. If <code>type = "conventional"</code>, the standard deviation is the measure
used, and if <code>type = "robust"</code>, the MAD is the measure used.</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>logical; should a progress bar be displayed?</p></dd>


<dt id="arg-seed-nmf">seed.nmf<a class="anchor" aria-label="anchor" href="#arg-seed-nmf"></a></dt>
<dd><p>random seed to use for NMF-based algorithms</p></dd>


<dt id="arg-seed-data">seed.data<a class="anchor" aria-label="anchor" href="#arg-seed-data"></a></dt>
<dd><p>seed to use to ensure each algorithm operates on the same
set of subsamples</p></dd>


<dt id="arg-file-name">file.name<a class="anchor" aria-label="anchor" href="#arg-file-name"></a></dt>
<dd><p>if not <code>NULL</code>, the returned array will be saved at each
iteration as well as at the end of the function call to an <code>rds</code> object
with <code>file.name</code> as the file name.</p></dd>


<dt id="arg-time-saved">time.saved<a class="anchor" aria-label="anchor" href="#arg-time-saved"></a></dt>
<dd><p>logical; if <code>TRUE</code>, the date saved is appended to
<code>file.name</code>. Only applicable when <code>file.name</code> is not <code>NULL</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An array of dimension <code>nrow(x)</code> by <code>reps</code> by <code>length(algorithms)</code> by
<code>length(nk)</code>. Each cube of the array represents a different k. Each slice
of a cube is a matrix showing consensus clustering results for algorithms.
The matrices have a row for each sample, and a column for each subsample.
Each entry represents a class membership.</p>
<p>When "hdbscan" is part of <code>algorithms</code>, we do not include its clustering
array in the consensus result. Instead, we report two summary statistics as
attributes: the proportion of outliers and the number of clusters.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>See examples for how to use custom algorithms and distance functions. The
default clustering algorithms provided are:</p><ul><li><p>"nmf": Nonnegative Matrix Factorization (using Kullback-Leibler Divergence
or Euclidean distance; See Note for specifications.)</p></li>
<li><p>"hc": Hierarchical Clustering</p></li>
<li><p>"diana": DIvisive ANAlysis Clustering</p></li>
<li><p>"km": K-Means Clustering</p></li>
<li><p>"pam": Partition Around Medoids</p></li>
<li><p>"ap": Affinity Propagation</p></li>
<li><p>"sc": Spectral Clustering using Radial-Basis kernel function</p></li>
<li><p>"gmm": Gaussian Mixture Model using Bayesian Information Criterion on EM
algorithm</p></li>
<li><p>"block": Biclustering using a latent block model</p></li>
<li><p>"som": Self-Organizing Map (SOM) with Hierarchical Clustering</p></li>
<li><p>"cmeans": Fuzzy C-Means Clustering</p></li>
<li><p>"hdbscan": Hierarchical Density-based Spatial Clustering of Applications
with Noise (HDBSCAN)</p></li>
</ul><p>The progress bar increments on every unit of <code>reps</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The <code>nmf.method</code> options are "brunet" (Kullback-Leibler Divergence) and
"lee" (Euclidean distance). When "hdbscan" is chosen as an algorithm to
use, its results are excluded from the rest of the consensus clusters. This
is because there is no guarantee that the cluster assignment will have
every sample clustered; more often than not there will be noise points or
outliers. In addition, the number of distinct clusters may not even be
equal to <code>nk</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Derek Chiu, Aline Talhouk</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">hgsc</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">hgsc</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Custom distance function</span></span></span>
<span class="r-in"><span><span class="va">manh</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">x</span>, method <span class="op">=</span> <span class="st">"manhattan"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Custom clustering algorithm</span></span></span>
<span class="r-in"><span><span class="va">agnes</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span>, <span class="va">k</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cutree.html" class="external-link">cutree</a></span><span class="op">(</span><span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/agnes.html" class="external-link">agnes</a></span><span class="op">(</span><span class="va">d</span>, diss <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="va">k</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="st">"agnes"</span>, <span class="va">agnes</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cc</span> <span class="op">&lt;-</span> <span class="fu">consensus_cluster</span><span class="op">(</span><span class="va">dat</span>, reps <span class="op">=</span> <span class="fl">6</span>, algorithms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pam"</span>, <span class="st">"agnes"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>distance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"euclidean"</span>, <span class="st">"manh"</span><span class="op">)</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">cc</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  int [1:100, 1:6, 1:4, 1:3] 1 1 NA NA NA 1 1 NA 2 NA ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - attr(*, "dimnames")=List of 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ : chr [1:100] "TCGA.04.1331_PRO.C5" "TCGA.04.1332_MES.C1" "TCGA.04.1336_DIF.C4" "TCGA.04.1337_MES.C1" ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ : chr [1:6] "R1" "R2" "R3" "R4" ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ : chr [1:4] "PAM_Euclidean" "PAM_Manh" "AGNES_Euclidean" "AGNES_Manh"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ : chr [1:3] "2" "3" "4"</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Derek Chiu, Aline Talhouk.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

